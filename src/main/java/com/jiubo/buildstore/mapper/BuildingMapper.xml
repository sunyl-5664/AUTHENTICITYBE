<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jiubo.buildstore.dao.BuildingDao">

    <select id="getAllBulidBypage" resultType="com.jiubo.buildstore.bean.BuildingBean">
        SELECT a.B_ID,a.HT_NAME,a.IS_SALE,a.ALIAS,a.PRO_ID,a.LD_ID,a.DEV_ID,a.OPEN_DATE,
        a.MIN_AREA,a.MAX_AREA,a.UNIT_PRICE,a.TITLE_PRICE,a.BT_ID,a.ADRESS,a.CREATE_DATE,
        a.CHA_ID,b.BT_NAME,d.CHA_NAME
        from building a,building_type b ,characteristic d
        <where>
            a.CHA_ID = d.CHA_ID and a.BT_ID = b.BT_ID
            /*省id*/
            <if test="buildingBean.proIdList != null and buildingBean.proIdList.size() > 0">
                and a.PRO_ID in
                <foreach collection="buildingBean.proIdList" open="(" close=")" separator="," item="proId">
                    #{proId}
                </foreach>
            </if>
            /*是否出售*/
            <if test="buildingBean.isSaleList != null and buildingBean.isSaleList.size() > 0">
                and a.IS_SALE in
                <foreach collection="buildingBean.isSaleList" open="(" close=")" separator="," item="isSale">
                    #{isSale}
                </foreach>
            </if>
            /*区域*/
            <if test="buildingBean.ldIdList != null and buildingBean.ldIdList.size() > 0">
                and a.LD_ID in
                <foreach collection="buildingBean.ldIdList" open="(" close=")" separator="," item="ldId">
                    #{ldId}
                </foreach>
            </if>
            /*开发商*/
            <if test="buildingBean.devIdList != null and buildingBean.devIdList.size() > 0">
                and a.DEV_ID in
                <foreach collection="buildingBean.devIdList" open="(" close=")" separator="," item="devId">
                    #{devId}
                </foreach>
            </if>
            /*楼盘类型*/
            <if test="buildingBean.btIdList != null and buildingBean.btIdList.size() > 0">
                and a.BT_ID in
                <foreach collection="buildingBean.btIdList" open="(" close=")" separator="," item="btId">
                    #{btId}
                </foreach>
            </if>
            /*楼盘户型*/
            <if test="buildingBean.bIdList != null and buildingBean.bIdList.size() > 0">
                and a.B_ID in
                <foreach collection="buildingBean.bIdList" open="(" close=")" separator="," item="bId">
                    #{bId}
                </foreach>
            </if>
            /*房源特色*/
            <if test="buildingBean.chaIdList != null and buildingBean.chaIdList.size() > 0">
                and a.CHA_ID in
                <foreach collection="buildingBean.chaIdList" open="(" close=")" separator="," item="chaId">
                    #{chaId}
                </foreach>
            </if>
            <if test="buildingBean.openTimeList != null and buildingBean.openTimeList.size() > 0">
                and
                <foreach collection="buildingBean.openTimeList" open="(" close=")" separator="or" item="item">
                    (DATE_FORMAT(a.OPEN_DATE, '%Y-%m-%d' ) > DATE_FORMAT(#{item.startDate}, '%Y-%m-%d' )
                    and DATE_FORMAT(#{item.endDate}, '%Y-%m-%d' ) >= DATE_FORMAT(a.OPEN_DATE, '%Y-%m-%d' ))
                </foreach>
            </if>
            <if test="buildingBean.areaList != null and buildingBean.areaList.size() > 0">
            and
                <foreach collection="buildingBean.areaList" open="(" close=")" separator="or" item="item">
                    <if test="null != item and item.minArea != null and item.maxArea == null">
                        #{item.minArea} > a.MIN_AREA
                    </if>
                    <if test="null != item and item.maxArea != null and item.minArea == null">
                       #{item.maxArea} >= a.MAX_AREA
                    </if>
                    <if test="null != item and item.maxArea != null and item.minArea != null">
                        #{item.maxArea} >= a.MIN_AREA and a.MAX_AREA > #{item.minArea}
                    </if>
                </foreach>
            </if>
            <if test="buildingBean.totalPriceList != null and buildingBean.totalPriceList.size() > 0">
            and
                <foreach collection="buildingBean.totalPriceList" open="(" close=")" separator="or" item="item">
                    <if test="null != item and item.startTitlePrice != null">
                        a.TITLE_PRICE > #{item.startTitlePrice}
                    </if>
                    <if test="null != item and item.endTitlePrice != null">
                      and  #{item.endTitlePrice} >= a.TITLE_PRICE
                    </if>
                </foreach>
            </if>
            <if test="buildingBean.unitPriceList != null and buildingBean.unitPriceList.size() > 0">
            and
                <foreach collection="buildingBean.unitPriceList" open="(" close=")" separator="or" item="item">
                    <if test="null != item and item.startUnitPrice != null">
                         a.UNIT_PRICE > #{item.startUnitPrice}
                    </if>
                    <if test="null != item and item.endUnitPrice != null">
                       and #{item.endUnitPrice} >= a.UNIT_PRICE
                    </if>
                </foreach>
            </if>
            <if test="buildingBean.startTime != null and buildingBean.startTime != ''">
                and (DATE_FORMAT(a.OPEN_DATE, '%Y-%m-%d' ) > #{buildingBean.startTime}
            </if>
            <if test="buildingBean.endTime != null and buildingBean.endTime != ''">
                and #{buildingBean.endTime} >= DATE_FORMAT(a.OPEN_DATE, '%Y-%m-%d' ))
            </if>
        </where>
    </select>
</mapper>
